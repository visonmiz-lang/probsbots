// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Metrics {
  id String @id @default(uuid())

  name  String
  model ModelType

  metrics Json[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Chat {
  id String @id @default(uuid())

  model      ModelType @default(Deepseek)
  chat       String    @default("<no chat>")
  reasoning  String
  userPrompt String
  tradings   Trading[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Trading {
  id String @id @default(uuid())

  symbol     Symbol
  opeartion  Opeartion
  leverage   Int?
  amount     Float?
  pricing    Float?
  stopLoss   Float?
  takeProfit Float?
  technicalIndicatorsAtOpen Json?       // RSI, MACD –∏ —Ç.–¥. –Ω–∞ –º–æ–º–µ–Ω—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è
  marketConditionsAtOpen    Json?       // –£—Å–ª–æ–≤–∏—è —Ä—ã–Ω–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
  aiReasoningAtOpen         String?     // –ü–æ–ª–Ω—ã–π reasoning AI –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
  positionOutcome           String?     // 'win', 'loss', 'open'
  closedAt                  DateTime?   // –ö–æ–≥–¥–∞ –∑–∞–∫—Ä—ã–ª–∞—Å—å –ø–æ–∑–∏—Ü–∏—è
  finalPnl                  Float?      // –§–∏–Ω–∞–ª—å–Ω—ã–π PnL
  exitPrice                 Float?      // –¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
  exitReasoning             String?     // –ü–æ—á–µ–º—É –∑–∞–∫—Ä—ã–ª–∏ (AI –∏–ª–∏ manual)
  bybitOrderId String?  // üëà –î–û–ë–ê–í–¨ –≠–¢–û –ü–û–õ–ï

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Chat   Chat?   @relation(fields: [chatId], references: [id], onDelete: Cascade)
  chatId String?
}

enum Opeartion {
  Buy
  Sell
  Hold
}

enum Symbol {
  BTC
  ETH
  BNB
  SOL
  DOGE
}

enum ModelType {
  Deepseek
  DeepseekThinking
  Qwen
  Doubao
}
